(()=>{const h=o=>Array(Math.max(3-String(o).length+1,0)).join(0)+o,l=window.location.origin,g=document.getElementById("no"),E=document.getElementById("form"),B=document.getElementById("txt_display"),m=document.getElementById("last"),d=document.getElementById("prepare"),w=document.getElementById("loading"),x=document.getElementById("display"),b=document.getElementById("counter"),r={};function I(){d.style.display="none",x.style.display="block"}let u=!0;window.AudioContext=window.AudioContext||window.webkitAudioContext;window.cacheAudio=async()=>{const o=await caches.open("audio-antrian-cache");try{w.style.display="block",d.style.display="none";let t=await fetch(l+"/list-audios").then(e=>e.json());t=t.map(e=>l+"/public"+e);for(let e=0;e<t.length;e++){const n=t[e];await o.match(n)||await o.add(n)}w.style.display="none",d.style.display="block"}catch(t){alert(t.message||"Error Network")}};async function M(o){u=!1;const t=new AudioContext,e=await caches.open("audio-antrian-cache");for(let n=0;n<o.length;n++){const a=o[n];try{let s=await e.match(a);s||(await e.add(a),s=await e.match(a));const c=await s.arrayBuffer(),i=t.createBufferSource(),p=()=>new Promise(f=>{i.onended=f});i.buffer=await t.decodeAudioData(c),i.connect(t.destination),i.start(),await p()}catch(s){console.error(s)}}u=!0}E.onsubmit=function(o){o.preventDefault();const t=B.value;new EventSource("/sse/"+t).onmessage=async function(e){const n=JSON.parse(e.data);if(n.type==="display"&&u){m.innerHTML="";const a=n.data,s=h(a.no);g.innerHTML=s,b.innerHTML=a.counter,r[a.counter]=s;for(const i in r)m.innerHTML+=`
          <div class="frame-last">
            <h4 class="text-last">LOKET ${i} : ${r[i]}</h4>
          </div>
        `;const c=a.audios.map(i=>l+"/public/audio/"+i+".wav");await M(c)}},I()};function y(){const o=new Date;let t=o.getHours(),e=o.getMinutes(),n=o.getSeconds(),a="AM";t==0&&(t=12),t>12&&(t=t-12,a="PM"),t=t<10?"0"+t:t,e=e<10?"0"+e:e,n=n<10?"0"+n:n;let s=t+":"+e+":"+n+" "+a;document.getElementById("MyClockDisplay").innerText=s,document.getElementById("MyClockDisplay").textContent=s,setTimeout(y,1e3)}y();window.showTime=y;})();
